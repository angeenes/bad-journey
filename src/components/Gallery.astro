---
---

<section class="container-full">
  <article  id="gallery" class="gallery container"></article>
   <div id="load-more" style="text-align: center;">Loading...</div>
</section>

<script>
let currentPage = 1;
const itemsPerPage = 10;

async function fetchData(page) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/posts?_page=${page}&_limit=${itemsPerPage}`
  );
  const data = await response.json();
  return data;
}

function createCardTemplate(item) {
  return `
        <div class="card">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://via.placeholder.com/300x150" alt="Image for post ${item.id}" loading="lazy">
            <h2>${item.title}</h2>
            <p>${item.body}</p>
        </div>
    `;
}

function renderCards(data) {
  const cardContainer = document.getElementById('gallery');
  data.forEach((item) => {
    const cardTemplate = createCardTemplate(item);
    cardContainer.insertAdjacentHTML('beforeend', cardTemplate);
  });
}

function observeImages() {
  const images = document.querySelectorAll('img:not([data-loaded="true"])');
  const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const image = entry.target;
        image.src = image.dataset.src;
        image.onload = () => {
          image.dataset.loaded = 'true';
        };
        observer.unobserve(image);
      }
    });
  });

  images.forEach((image) => imageObserver.observe(image));
}

function setupInfiniteScroll() {
  const loadMoreElement = document.getElementById('load-more');
  const loadMoreObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(async (entry) => {
      if (entry.isIntersecting) {
        observer.unobserve(loadMoreElement);
        currentPage++;
        const newData = await fetchData(currentPage);
        renderCards(newData);
        observeImages();
        observer.observe(loadMoreElement);
      }
    });
  });

  loadMoreObserver.observe(loadMoreElement);
}

async function init() {
  const initialData = await fetchData(currentPage);
  renderCards(initialData);
  observeImages();
  setupInfiniteScroll();
}

init();

</script>

<style lang='scss'>
.gallery {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  flex-wrap: wrap;
  gap: 1.5rem;
  .card {
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    transition: 0.3s;
    width: 300px;
    border-radius: 5px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .card:hover {
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    cursor: pointer;
  }
  .card img {
    width: 100%;
    height: auto;
    border-radius: 5px;
    margin-bottom: 15px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .card img[data-loaded="true"] {
    opacity: 1;
  }
}
</style>
